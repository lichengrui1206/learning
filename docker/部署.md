## 部署

第一步解决idea中DockerFile文件中的tcp连接问题

###  SpringBoot应用程序镜像

首先得有一个可以运行的 SpringBoot 项目，在项目根目录创建 Dockerfile 文件，并配置（IDEA）一下Docke，采用TCP套接字，然后在Docke服务器更改一下 service 文件

```nginx
vim /etc/systemd/system/multi-user.target.wants/docker.service
```

添加标红内容 `-H tcp://0.0.0.0`

![img](https://gitee.com/ximuliunian/notes/raw/main/Docker/md.image/Docker/image-20240527102647867.png)

重启Docker服务，如果是云服务器，记得开启2375 TCP连接端口

```nginx
systemctl daemon-reload && systemctl restart docker.service
```

![image-20240529154812459](C:\Users\qwxqy\AppData\Roaming\Typora\typora-user-images\image-20240529154812459.png)

### 对项目进行打包，然后编写DockerFile文件

#### 第一种打包镜像

```nginx
# Base 镜像
FROM ubuntu
# 作者
LABEL authors="lwy"
# 安装JDK环境
RUN apt update && apt install -y openjdk-17-jdk
# 复制jar包
COPY target/weiliao-0.0.1.jar app.jar
# 启动命令，在容器启动的时候执行的命令
CMD java -jar app.jar
```

打包好的镜像会存放在服务器中，可以使用以下命令运行

```nginx
docker run -d -p 8080:8080 [镜像]
```

-d 代表在后台运行

-p 表示绑定端口，前面为 宿主机端口:容器端口

#### 第二种打包并添加容器

先打包项目./target/Application-0.0.1-SNAPSHOT.jar便是打包后的项目

```nginx
#1.定义父镜像(定义当前工程依赖的环境)：
FROM openjdk:8-jdk-alpine
#2.定义作者信息（可以省略不写）：
MAINTAINER  lwy
#4.将jar包添加到容器（将jar包存入镜像中）：
ADD ./target/Application-0.0.1-SNAPSHOT.jar hello-idea-docker.jar
#4.指定这个容器对外暴露的端口号
EXPOSE 8080
#5.定义容器启动执行的命令： 当通过此镜像启动容器的时候，执行的命令
ENTRYPOINT ["java","-jar","/hello-idea-docker.jar"]
```

#### 利用ubuntu创建DockerFile文件

```nginx
# 指定基础镜像
FROM ubuntu:16.04
#配置环境变量，JDK的安装目录，容器内时区
ENV JAVA_DIR=/usr/local
# 作者
LABEL authors="lwy"
# 安装JDK环境
RUN apt update && apt install -y openjdk-17-jdk
# 复制jar包
COPY target/weiliao-0.0.1.jar app.jar
# 启动命令，在容器启动的时候执行的命令
CMD java -jar app.jar
```



#### 构建镜像

```nginx
docker bulid -t myImage:1.0 .
```

